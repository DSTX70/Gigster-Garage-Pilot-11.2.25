import { ENV } from '../env.server'; import { mockCreateIntake, mockCreatePlan, mockExecutePlan, mockGetReview } from './mocks.server'; type Intake={title:string;objective:string;due_date:string;owner:string;template?:string;stack?:string;brand_tokens_ref?:string;}; async function safeJSON(url:string,init?:RequestInit){ try{const r=await fetch(url,init); if(!r.ok) throw new Error('HTTP '+r.status); return await r.json(); }catch(e){ if(ENV.MOCK_FALLBACK) return null; throw e; }} export async function createIntake(payload:Intake){ if(ENV.USE_MOCKS) return mockCreateIntake(payload); const res=await safeJSON(`${ENV.HUB_BASE_URL}/intake`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}); return res??mockCreateIntake(payload);} export async function createPlan(ticketId:string,body:any){ if(ENV.USE_MOCKS) return mockCreatePlan(ticketId,body); const res=await safeJSON(`${ENV.HUB_BASE_URL}/plan/${encodeURIComponent(ticketId)}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); return res??mockCreatePlan(ticketId,body);} export async function executePlan(planId:string,body:any){ if(ENV.USE_MOCKS) return mockExecutePlan(planId,body); const res=await safeJSON(`${ENV.HUB_BASE_URL}/execute/${encodeURIComponent(planId)}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); return res??mockExecutePlan(planId,body);} export async function getReview(runId:string){ if(ENV.USE_MOCKS) return mockGetReview(runId); const res=await safeJSON(`${ENV.HUB_BASE_URL}/review/${encodeURIComponent(runId)}`); return res??mockGetReview(runId);}